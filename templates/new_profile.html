<!-- templates/new_profile.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Create new profile</title>
  <link rel="stylesheet" href="style.css">
  <script>
    async function loadQuestions(){
      const res = await fetch('/questions_json');
      const q = await res.json();
      const container = document.getElementById('questions');
      q.forEach((qq, idx) => {
        const div = document.createElement('div');
        div.innerHTML = `<p>${qq.question}</p>`;
        qq.options.forEach((opt, i)=>{
          const name = `q${idx}`;
          const val = (i===0? 'a': (i===1? 'b':'c'));
          div.innerHTML += `<label><input type="radio" name="${name}" value="${val}" required> ${opt}</label><br>`;
        });
        container.appendChild(div);
      });
    }
    function submitForm(e){
      e.preventDefault();
      const name = document.getElementById('name').value;
      const gender = document.querySelector('input[name=gender]:checked')?.value;
      const age = document.getElementById('age').value;
      const radios = document.querySelectorAll('[id^=questions] input[type=radio]');
      const choices = [];
      // simpler: iterate question count
      const container = document.getElementById('questions');
      const qs = container.children;
      for(let i=0;i<qs.length;i++){
        const radios = qs[i].querySelectorAll('input[type=radio]');
        for(let r of radios){
          if(r.checked) { choices.push(r.value); break; }
        }
      }
      const form = document.createElement('form');
      form.method = "POST";
      form.action = "/new_profile";
      const f1 = document.createElement('input'); f1.name='name'; f1.value = name; form.appendChild(f1);
      const f2 = document.createElement('input'); f2.name='gender'; f2.value = gender; form.appendChild(f2);
      const f3 = document.createElement('input'); f3.name='age'; f3.value = age; form.appendChild(f3);
      const f4 = document.createElement('input'); f4.name='choices'; f4.value = JSON.stringify(choices); form.appendChild(f4);
      document.body.appendChild(form);
      form.submit();
    }
    window.onload = function(){
      loadQuestions();
      document.getElementById('profileForm').addEventListener('submit', submitForm);
    }
  </script>
</head>
<body>
  <h1>Create New Profile</h1>
  <form id="profileForm">
    Name: <input id="name" name="name" required><br>
    Gender: <label><input type="radio" name="gender" value="M" required> M</label>
            <label><input type="radio" name="gender" value="F"> F</label><br>
    Age: <input id="age" name="age" type="number" min="1" required><br>

    <div id="questions"></div>

    <button type="submit">Create Profile</button>
  </form>
</body>
</html>
